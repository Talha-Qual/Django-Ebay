{% extends "auctions/layout.html" %}

{% block main %}
<h2>One of a Kind</h2>

<!-- List the listing -->
<section>
  {{listing.title}}
  <br>
  {{listing.description}}
  <br>
  Price: ${{listing.bid}}
  <br>
  {% if listing.image %}
      <img src = "{{listing.image.url}}" alt = "someone forgot to add an image here :( " style = "max-height: 300px;">
      <br>
  {% endif %}
  The category is: {{listing.category}}
</section>

<!-- Bidding Stuff -->
{% if user.is_authenticated %}
  {% if user != listing.user and listing.active == 1 %}
  <form action = "{% url 'view_listing' listing.id %}" method = "POST">
    {% csrf_token %}
    <input type = "number" name = "amount"
      {% if listing.highestbid > listing.price %}
      minimum = "{{listing.highestbid}}" value = "{{listing.highestbid}}"
      {% else %}
      minimum = "{{ listing.price }}" value = "{{ listing.price }}"
      {% endif %}
    >
    <button type = "submit" name = "bid">Bid</button>
  </form>

    {% endif %}
    Original Price: ${{ listing.price }}
    {{ total_bids }} bids total

    {% if user != listing.user %} 
    {% if winner.user_id == user.id %}
    Congratulations, you win!
    {% elif user.id == bids.user_id %}
    Your bid is too low to win the current auction :(
      {% endif %}
    {% endif %}
{% endif %}

<!-- Check Users -->
{% if user == listing.user %}
  {% if listing.active == 1 %}
  <form  action="{% url 'view_listing' listing.id %}" method="POST">
    {% csrf_token %}
    <button type="submit" name="close">Close Auction</button>
  </form>
  {% endif %}

  <!-- Watchlist stuff -->
  {% if watching and watching.active == 1 %}
  <form action = "{% url 'view_listing' listing.id %}" method = "POST">
    {% csrf_token %}
    <button type = "submit" name = "unwatch"> Remove from Watchlist </button>
  </form>
  {% elif not watching or watching.active == 0 %}
  <form action = "{% url 'view_listing' listing.id %}" method = "POST">
      {% csrf_token %}
      <button type = "submit" name = "watch"> Add this item to your Watchlist!</button>
  </form>
  {% endif %}
{% endif %}

<!-- Comments Stuff -->

<!-- View comments -->
<br>
Comments:
{% if comments %}
  {% for comment in comments %}
    {{comment.user}}
    {{ comment.comment }}
    {{comment.timestamp}}
  {% endfor %}
{% endif %}



<!-- submit comments -->
{% if user.is_authenticated %}
  <form action = "{% url 'view_listing' listing.id %}" method = "POST">
    {% csrf_token %}
    {{ comment_form }}
    <button type = "submit" name = "comment">Post</button>
  </form>
{% endif %}
{% endblock %}